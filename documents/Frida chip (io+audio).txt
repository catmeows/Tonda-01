Frida
Frida is custom chip that cares about i/o and sound in Tonda 01 computer.

I/O
Frida chip controls keyboard, single Atari joystick port (including two A/D converters), two 8 bit ports and tape input and output. 
There are six registers dedicated to interfacing.
Bits 0 and 1 of MUX CTRL port select device
   ......00 keyboard
   ......01 joystick/tape
   ......10 user port 1
   ......11 user port 2
Bits of DIR CTRL select what bit in DATA register is input or output. 0 is for input, 1 is for output.
DATA register is used to read/write bits from/to device.



KEYBOARD
Tonda 01 has 56 key keyboards.

ATARI JOYSTICK PORT
Joystick port has 5 digital pins and 2 analog pins. As for digital pins, they can be used either as input or output.
Analog pins can be read only.

Reading digital pins:
1) Write value %00000001 to MUX CTRL port to select joystick/tape
2) Write value %00000000 (all READ) to DIR CTRL port
3) Read value from DATA port
   
Now value has lower 5 bits set according values on pins: ???64321. With standard joystick wiring it is translanted as ???FRLUD (Fire, Right, Left, Up, Down).
Bit is set if when direction/fire is triggered.   

Reading analog pins:
1) Read port POTX (POTY) to get time from last edge 

TAPE
Reading tape input
1) Write value %00000001 to MUX CTRL port to select joystick/tape
2) Write value %00000000 (all READ) to DIR CTRL port
3) Read value from DATA port
4) Isolate bit 5, that is reading on tape input

Writing to tape output
1) Write value %00000001 to MUX CTRL port to select joystick/tape
2) Write value %01000000 (bit 6 to WRITE) to DIR CTRL port
3) Write value to DATA port, bit 6 will be send to tape

Note on jostick/tape port
Joystick and tape wires are connected to single port. Low five bits (b0,b1,b2,b3,b4) represent digital pins of joystick, bit 5 is tape input (ear), bit 6 is tape output (mic).
Bit 7 connected to keyboard LED.
Depending on DIR CTRL value (direction control), it is possible to read or write to any combination of the 7 bits. However, result of reading or writing really depends on device connected to atari/tape connector.
For example you can send data to bit 5 (ear) but tape recorder simply do not monitor voltage on its ear connector. But it is possible to connect some other device to ear connector and that device may react on data sent trough ear bit. 

USER PORT 1, 2
Are just two 8-bit bidirectional ports. Depending on setting of DIR CTRL, each bit can act as input or output.

AUDIO
Frida provides 4 channels: A, B, C, D
Channels A,B are mixed together as first output and C,D are mixed together as second audio output. In normal circumstancies, these two audio lines are connected to internal speaker.  
Connecting 3.5mm stereo jack into AUDIO connector disables internal speaker. In such case, channels A,B are routed to left output and channels C,D are routed to right output.

Each channel is controlled by 5 registers:
FREQL - lower 8 bits of frequency (pitch) control
FREQH - higher 4 bits of frequency (pitch) control
WAVEL - low wave form bits
WAVEH - high wave form bits
AUD CTRL - control port with bits ....NVVV where E is enabled, N is Noise flag, VVV is volume.

FREQL and FREQH forms frequency divider (higher value means lower frequency/tone pitch) that gives pace at which two wave register, WAVEL and WAVEH registers are shifted.
When FREQL and FREQH are both zeroed, there is clock is stopped
Most significant bits of WAVEL and WAVEH forms value 0..3 that gives output level for the particular channel.
This output level is multiplied by value VVV from AUD CTRL register.
When N bit is reset, most significant bit shifted out from WAVEL/WAVEH register and is put into bit 0. Effectively, the values in WAVEL/WAVEH registers are rotated.
When N bit is set, the shift register is turned into linear feedback register producing pseudorandom stream of bits.

To set a channel
1) disable channel, set FREQL=0, then FREQH=0
2) set WAVEL, WAVEH 
   e.g. to set triangle wave 
   WAVEL = %10101000 
   WAVEH = %01110000
   
   3 ..X.....
   2 .XXX....
   1 XXXXX...
   
3) set FREQL, FREQH
            
   pitch = 1.75MHz / (16 * FREQ)
   
   FREQ = 1.75MHz / (16 * pitch)
   
   Example:
   Note  Freq[Hz] FREQ
         26.71    4095
   A0    27.50    3977
   A#0   29.14    3753
   B0    30.87    3543
   C1    32.70    3345
   C2    65.41    1672
   C3   130.8      836
   C4   261.6      418
   C5   523.3      209
   C6  1047        104
   C#6 1109         99
   D6  1175         93
   D#6 1245         88
   E6  1319         83
   F6  1397         78 
   F#6 1480         74
   G   1568         70
   G#6 1661         66
   A6  1760         62
   A#6 1865         59
   B6  1976         55
   C7  2093         52
   C#7 2217         49         
   D7  2349         47
   D#7 2489         44
   E7  2637         42
   
 
4) set volume 0..7 in VVV of AUD CTRL port
5) (optional) enable LFSR by setting N in AUD CTRL port


FRIDA PORT ADRESSING:

Note: Due incomplete address decoding, ports are mirrored at $C000, $C020, $C040 and $C060

$C000 - MUX CTRL (W)
$C001 - DIR CTRL (W)
$C002 - DATA (W/R)
$C003 - KEYB CTRL (W)
$C004 - POTX TIMER (R)
$C005 - POTY TIMER (R)

$C008 - channel A FREQL (W)
$C009 - channel B FREQL (W)
$C00A - channel C FREQL (W)
$C00B - channel D FREQL (W)

$C00C - channel A FREQH (W)
$C00D - channel B FREQH (W)
$C00E - channel C FREQH (W)
$C00F - channel D FREQH (W)

$C010 - channel A WAVEL (W)
$C011 - channel B WAVEL (W)
$C012 - channel C WAVEL (W)
$C013 - channel D WAVEL (W)

$C014 - channel A WAVEH (W)
$C015 - channel B WAVEH (W)
$C016 - channel C WAVEH (W)
$C017 - channel D WAVEH (W)

$C018 - channel A AUD CTRL (W)
$C019 - channel B AUD CTRL (W)
$C01A - channel C AUD CTRL (W)
$C01B - channel D AUD CTRL (W)
